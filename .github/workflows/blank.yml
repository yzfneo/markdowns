name: Deploy Markdown to GitHub Pages

on:
  push:
    branches: [ "main" ]
    paths: [ "202509_travel.md" ]
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Build job
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install markdown

      - name: Convert Markdown to HTML
        run: |
          python -c "
          import markdown
          import os

          # Read the markdown file
          with open('202509_travel.md', 'r', encoding='utf-8') as f:
            md_content = f.read()

          # Convert to HTML
          html_content = markdown.markdown(md_content, extensions=['tables', 'fenced_code', 'codehilite'])

          # Create a simple HTML template
          html_template = f'''
          <!DOCTYPE html>
          <html lang='en'>
          <head>
              <meta charset='UTF-8'>
              <meta name='viewport' content='width=device-width, initial-scale=1.0'>
              <title>Japan to North America: A Cross-Cultural Odyssey</title>
              <style>
                  body {{
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      line-height: 1.6;
                      max-width: 800px;
                      margin: 0 auto;
                      padding: 20px;
                      background-color: #f5f5f5;
                  }}
                  .container {{
                      background: white;
                      padding: 40px;
                      border-radius: 8px;
                      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                  }}
                  h1, h2, h3 {{
                      color: #2c3e50;
                  }}
                  img {{
                      max-width: 100%;
                      height: auto;
                      border-radius: 4px;
                      margin: 20px 0;
                  }}
                  iframe {{
                      width: 100%;
                      height: 450px;
                      border: none;
                      border-radius: 4px;
                      margin: 20px 0;
                  }}
                  .highlight {{
                      background-color: #f8f9fa;
                      padding: 20px;
                      border-left: 4px solid #007bff;
                      margin: 20px 0;
                  }}
                  blockquote {{
                      border-left: 4px solid #ddd;
                      padding-left: 20px;
                      margin: 20px 0;
                      font-style: italic;
                      color: #666;
                  }}
                  table {{
                      width: 100%;
                      border-collapse: collapse;
                      margin: 20px 0;
                  }}
                  th, td {{
                      border: 1px solid #ddd;
                      padding: 12px;
                      text-align: left;
                  }}
                  th {{
                      background-color: #f8f9fa;
                      font-weight: 600;
                  }}
                  pre {{
                      background-color: #f8f9fa;
                      padding: 15px;
                      border-radius: 4px;
                      overflow-x: auto;
                  }}
                  code {{
                      background-color: #f8f9fa;
                      padding: 2px 6px;
                      border-radius: 3px;
                  }}
                  @media (max-width: 768px) {{
                      body {{
                          padding: 10px;
                      }}
                      .container {{
                          padding: 20px;
                      }}
                  }}
              </style>
          </head>
          <body>
              <div class='container'>
                  {html_content}
              </div>
          </body>
          </html>
          '''

          # Write the HTML file
          os.makedirs('_site', exist_ok=True)
          with open('_site/index.html', 'w', encoding='utf-8') as f:
              f.write(html_template)
          "

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'

  # Deployment job
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4.0.5
